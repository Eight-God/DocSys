<!DOCTYPE html>
<html style="height: 100%;">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>TextEditor</title>
    <script src="static/scripts/jquery.min.js"></script>
    <link href="static/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="static/bootstrapQ/qiao.css" rel="stylesheet">
    <script type="text/javascript" src="static/bootstrapQ/qiao.js"></script>
    <script type="text/javascript" src="js/common.js"></script>
    <script type="text/javascript" src="js/base64.js"></script>
    <script type="text/javascript" src="js/DocSys.js"></script>

    <!-- editormd -->
	<link href="static/markdown/css/editormd.min.css" rel="stylesheet">
	<link href="static/markdown/css/add.css" rel="stylesheet">
	<script src="static/markdown/editormd.js" type="text/javascript"></script>
    <script src="static/markdown/plugins/link-dialog/link-dialog.js" type="text/javascript"></script>
    <script src="static/markdown/plugins/reference-link-dialog/reference-link-dialog.js" type="text/javascript"></script>
    <script src="static/markdown/plugins/image-dialog/image-dialog.js" type="text/javascript"></script>
    <script src="static/markdown/plugins/code-block-dialog/code-block-dialog.js" type="text/javascript"></script>
    <script src="static/markdown/plugins/table-dialog/table-dialog.js" type="text/javascript"></script>
    <script src="static/markdown/plugins/emoji-dialog/emoji-dialog.js" type="text/javascript"></script>
    <script src="static/markdown/plugins/goto-line-dialog/goto-line-dialog.js" type="text/javascript"></script>
    <script src="static/markdown/plugins/help-dialog/help-dialog.js" type="text/javascript"></script>
    <script src="static/markdown/plugins/html-entities-dialog/html-entities-dialog.js" type="text/javascript"></script>
    <script src="static/markdown/plugins/preformatted-text-dialog/preformatted-text-dialog.js" type="text/javascript"></script>
	<script src="static/markdown/lib/raphael.min.js" type="application/javascript"></script>
	
	<script type="text/javascript" src="js/CommonEditor.js"></script>
    
    <style type="text/css" media="screen">
	  body {
	      overflow: hidden;
	  }
	
	  #editor {
	      margin: 40px 0 0 0;
	      position: absolute;
	      top: 0;
	      bottom: 0;
	      left: 0;
	      right: 0;
	  }
	  
	  .editormd-preview{
            left: 0 !important;
            right: auto !important;
      }

      .editormd .CodeMirror {
            float: right !important;
      }	  
	</style>
</head>
<body style="height: 100%; margin: 0;">
	<div id="mdViewer">
		<!-- <div id="mdViewerToolBar" style="height:100px;">
		     <button id="btnMdExitEdit" class="btn btn-default" type="button" onclick="EditormdEditor.exitEdit()" style="display:none">退出编辑
		     </button>
		     <button id="btnMdSaveWiki" class="btn btn-default" type="button" onclick="EditormdEditor.saveWiki()" style="display:none">保存
		     </button>
		</div>
		-->
		<div class="EditormdEditorContent" style="min-height: 600px;">
			<div id="mdPlayer">
			</div>
		</div>
	</div>
	<script type="text/javascript">
        var initEditorForEditormd = function()
		{
	  		console.log("initEditorForEditormd editState:" + editState);
	  		var params = {
	           width: "100%",
	           height: $(document).height()-70,
	           path : 'static/markdown/lib/',
	           markdown : "",	//markdown的内容默认务必是空，否则会出现当文件内容是空的时候显示默认内容
	           toolbar  : false,             // 关闭工具栏
	           codeFold : true,
	           searchReplace : true,
	           saveHTMLToTextarea : true,      // 保存 HTML 到 Textarea
	           htmlDecode : "style,script,iframe|on*",            // 开启 HTML 标签解析，为了安全性，默认不开启
	           emoji : true,
	           taskList : true,
	           tocm: true,          			// Using [TOCM]
	           tex : true,                      // 开启科学公式 TeX 语言支持，默认关闭
	           //previewCodeHighlight : false,  // 关闭预览窗口的代码高亮，默认开启
	           flowChart : true,
	           sequenceDiagram : true,
	           //dialogLockScreen : false,      // 设置弹出层对话框不锁屏，全局通用，默认为 true
	           //dialogShowMask : false,     // 设置弹出层对话框显示透明遮罩层，全局通用，默认为 true
	           //dialogDraggable : false,    // 设置弹出层对话框不可拖动，全局通用，默认为 true
	           dialogMaskOpacity : 0.2,    // 设置透明遮罩层的透明度，全局通用，默认值为 0.1
	           dialogMaskBgColor : "#000", // 设置透明遮罩层的背景颜色，全局通用，默认为 #fff
	           imageUpload : true,
	           imageFormats : ["jpg","JPG", "jpeg","JPEG","gif","GIF","png", "PNG","bmp","BMP", "webp","WEBP",],
	           imageUploadURL : "/DocSystem/Doc/uploadMarkdownPic.do?docId="+docInfo.docId + "&path=" + docInfo.path + "&name=" + docInfo.name,
	           onchange : function () {
	                console.log("CommonEditor onchange docInfo.edit:", docInfo.edit);       
	                isContentChanged = true;
		   		    console.log("textChange stackZ.size:" + stackZ.size() +  " stackY.size:" + stackY.size() +  " ctrlZY:" + isCtrlZY);
		   			if(false == isCtrlZY)
		   			{
		   				var content = editor.getMarkdown();
		   				stackZ.push(content);
		   			}
	           },
	           onpreviewing : function () {
	               console.log("initEditorForEditormd onpreviewing switchEditModeOnly:" + switchEditModeOnly);
	               if(switchEditModeOnly)
	               {
	            	   switchEditModeOnly = false;
	               }
	               else
	               {
	            	   _exitEdit(2);	//编辑器触发的退出编辑
	               }
	           },
	           onpreviewed :function () {
	               console.log("initEditorForEditormd onpreviewed switchEditModeOnly:" + switchEditModeOnly);
	               if(switchEditModeOnly)
	               {
	            	   switchEditModeOnly = false;
	               }
	               else
	               {
	            	   _enableEdit(2);	//编辑器触发的退出编辑
	               }
	
	           },
	           onload : function () {
	               console.log("initEditorForEditormd onload editState:" + editState);
	                //TODO: 如果主动设置编辑器状态，会触发回调则需要设置
					//switchEditModeOnly = true;
	                //Disable Edit
					editor.previewing(); 		  //加载成默认是预览
			        editor.setMarkdown(""); 	  //内容需要在onload的时候进行加载，会触发onchange事件
		    		isOnLoadTriggerChange = true;
	           },
	           onresize: function(){
	        	   console.log("initEditorForEditormd onresize");
	           }
	   		};
	   		
	  		editor = editormd("mdPlayer",params);
		};
		
		var configForEditormd = {
			"initEditor": initEditorForEditormd,
		};
		
		//页面加载完成处理函数
		$(document).ready(function () {
			var commonEditorForEditormd = new MxsdocAPI.CommonEditor(configForEditormd);
			commonEditorForEditormd.initForVDoc();
		});
    </script>
</body>
</html>